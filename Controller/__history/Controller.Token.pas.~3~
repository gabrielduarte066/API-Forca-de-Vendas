unit Controller.Token;

interface
uses Horse, System.JSON,System.SysUtils, DataSet.Serialize,REST.Types, REST.Json;
var
arrayUsuarios : TJSONArray;
procedure Registry;
implementation

uses Model.Usuario, U_dmConexao;

procedure GerarToken(Req: THorseRequest; Res: THorseResponse; Next: Tproc);
var  LToken : TJWT;
     LCompactToken : string;
begin

     dmUsuario.qrUsuario.Close;
     dmUsuario.qrUsuario.Open;
     arrayUsuarios := dmUsuario.qrUsuario.TOJSONArray();
     Res.Send<TJSONArray>(arrayUsuarios).Status(200);
end;

procedure Registry;
begin
    THorse.Get('/login', GerarToken);
    arrayUsuarios.Free;
    dmUsuario.qrUsuario.Close;
end;
end.
